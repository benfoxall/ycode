import i,{useRef as U,useState as l,useEffect as d}from"../web_modules/react.js";import{MonacoBinding as j,_SET_MONACO as x}from"./ext/y-monaco.js";import m from"./yconfig.js";const f="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min",M=(async()=>{const t=window;if(!t.require){const o=document.createElement("script");o.setAttribute("src",`${f}/vs/loader.min.js`);const n=new Promise(s=>o.addEventListener("load",s));document.head.append(o),await n,console.log("loaded require")}if(!t.monaco){t.require.config({paths:{vs:`${f}/vs`}}),t.MonacoEnvironment={getWorkerUrl:()=>o};let o=URL.createObjectURL(new Blob([`
        self.MonacoEnvironment = {
            baseUrl: '${f}'
        };
        importScripts('${f}/vs/base/worker/workerMain.min.js');
    `],{type:"text/javascript"}));await new Promise(n=>t.require(["vs/editor/editor.main"],n)),console.log("loaded monaco"),x(t.monaco)}return t.monaco})();export const useMonaco=()=>{const t=U(null),[o,n]=l(),[s,_]=l();return d(()=>{M.then(a=>{const c=a.editor.create(t.current,{value:"",wordWrap:"on"});a.editor.setTheme("vs-dark"),_(a),n(c)})},[]),d(()=>{if(o){const a=()=>{o.layout()};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}}},[o]),[t,o,s]};import p from"./monaco.module.css.proxy.js";export const Editor=({onChange:t})=>{const[o,n,s]=useMonaco(),[_,a]=l(!1),[c,g]=l();d(()=>{const e=m.doc.getText("monaco:name");let r=e;const u=b=>{if(b.adds.length){const v=e.toJSON();v!==r&&(g(v),r=v)}};return e.observe(u),()=>{e.unobserve(u)}},[]),d(()=>{if(n&&s&&c){const e=s.editor.createModel("_",void 0,s.Uri.file(c));e.onDidChangeContent(u=>{a(!0)});const r=m.doc.getText("monaco:content");return new j(r,e,new Set([n]),m.provider.awareness),n.setModel(e),()=>{e.dispose()}}},[n,c]);const h=e=>{if((window.navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&e.key=="s"){e.preventDefault();const r=n?.getValue();r&&(t(r),a(!1))}},[w,E]=l(!1),y=async e=>{e.preventDefault();const{href:r}=e.currentTarget;try{await navigator.clipboard.writeText(r),E(!0)}catch(u){window.open(r)}};return d(()=>{if(w){const e=setTimeout(E,2e3,!1);return()=>{clearTimeout(e)}}},[w]),i.createElement("div",{className:p.container,onKeyDown:h},m.initiator&&i.createElement("header",{className:p.header},i.createElement("span",null,c," ",_&&"*"),i.createElement("a",{href:"?"+m.room,target:"_blank",className:p.share,onClick:y},i.createElement("em",null,w?"link copied!":"share"),"\u2197\uFE0E")),i.createElement("div",{className:p.main,ref:o}))};
