import{u as M,m as Y,c as Br}from"./error-8f9bf959.js";import{y as Vr,z as Hr,A as Jr,B as zr,g as Fe,C as Mt,O as Xe,s as j,D as Pr,r as g,d as L,w as y,u as H,a as de,b as he,f as We,E as Be,F as qr,G as Yt,H as Ve,I as Rt,J as He,K as Je,L as pe,M as ue,N as ze,P as Kr,x as me,Q as Pe,n as D,U as qe,R as Ut,S as $r,p as Ke,T as jt,t as J,V as $e,W as Qe,X as Lt,Y as Qr,k as C,Z as Zr,q as Ze,_ as ee,m as en,$ as Nt,a0 as Gt,a1 as fe,a2 as tn,c as rn,a3 as nn,a4 as et}from"./function-d4886006.js";const an=typeof performance=="undefined"?null:performance,Ft=typeof crypto=="undefined"?null:crypto,sn=Ft!==null?e=>{const t=new ArrayBuffer(e),r=new Uint8Array(t);return Ft.getRandomValues(r),t}:e=>{const t=new ArrayBuffer(e),r=new Uint8Array(t);for(let n=0;n<e;n++)r[n]=Math.ceil(Math.random()*4294967295>>>0);return t};var on=an,cn=sn,ln={performance:on,cryptoRandomBuffer:cn};const dn=ln.cryptoRandomBuffer,hn=Math.random,Xt=()=>new Uint32Array(dn(4))[0],pn=[1e7]+-1e3+-4e3+-8e3+-1e11,Wt=()=>pn.replace(/[018]/g,e=>(e^Xt()&15>>e/4).toString(16)),R=Symbol;class un{constructor(e,t){this.left=e,this.right=t}}const U=(e,t)=>new un(e,t),ti=typeof DOMParser!="undefined"?new DOMParser:null,mn=e=>Vr(e,(t,r)=>`${r}:${t};`).join(""),ge=R(),ye=R(),tt=R(),rt=R(),nt=R(),at=R(),it=R(),be=R(),we=R(),fn={[ge]:U("font-weight","bold"),[ye]:U("font-weight","normal"),[tt]:U("color","blue"),[nt]:U("color","green"),[rt]:U("color","grey"),[at]:U("color","red"),[it]:U("color","purple"),[be]:U("color","orange"),[we]:U("color","black")},gn={[ge]:"[1m",[ye]:"[2m",[tt]:"[34m",[nt]:"[32m",[rt]:"[37m",[at]:"[31m",[it]:"[35m",[be]:"[38;5;208m",[we]:"[0m"},yn=e=>{const t=[],r=[],n=Mt();let a=[],i=0;for(;i<e.length;i++){const o=e[i],s=fn[o];if(s!==void 0)n.set(s.left,s.right);else if(o.constructor===String||o.constructor===Number){const c=mn(n);i>0||c.length>0?(t.push("%c"+o),r.push(c)):t.push(o)}else break}for(i>0&&(a=r,a.unshift(t.join("")));i<e.length;i++){const o=e[i];o instanceof Symbol||a.push(o)}return a},bn=e=>{const t=[],r=[];let n=0;for(;n<e.length;n++){const a=e[n],i=gn[a];if(i!==void 0)t.push(i);else if(a.constructor===String||a.constructor===Number)t.push(a);else break}for(n>0&&(t.push("[0m"),r.push(t.join("")));n<e.length;n++){const a=e[n];a instanceof Symbol||r.push(a)}return r},wn=zr?bn:yn,Bt=(...e)=>{console.log(...wn(e)),An.forEach(t=>t.print(e))},An=new Set,Vt=[nt,it,be,tt];let st=0,Ht=Fe();const kn=e=>{const t=Vt[st],r=Jr("log"),n=r!==null&&(r==="*"||r==="true"||new RegExp(r,"gi").test(e));return st=(st+1)%Vt.length,e+=": ",n?(...a)=>{const i=Fe(),o=i-Ht;Ht=i,Bt(t,e,we,...a.map(s=>typeof s=="string"||typeof s=="symbol"?s:JSON.stringify(s)),t," +"+o+"ms")}:Hr},Jt=e=>({[Symbol.iterator](){return this},next:e}),Sn=(e,t)=>Jt(()=>{let r;do r=e.next();while(!r.done&&!t(r.value));return r}),ot=(e,t)=>Jt(()=>{const{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}});class Tn extends Xe{constructor(e,t){super();this.doc=e,this.awareness=t}}class ct{constructor(e,t){this.clock=e,this.len=t}}class te{constructor(){this.clients=new Map}}const F=(e,t,r)=>t.clients.forEach((n,a)=>{const i=e.doc.store.clients.get(a);for(let o=0;o<n.length;o++){const s=n[o];kt(e,i,s.clock,s.len,r)}}),vn=(e,t)=>{let r=0,n=e.length-1;for(;r<=n;){const a=We((r+n)/2),i=e[a],o=i.clock;if(o<=t){if(t<o+i.len)return a;r=a+1}else n=a-1}return null},Ae=(e,t)=>{const r=e.clients.get(t.client);return r!==void 0&&vn(r,t.clock)!==null},lt=e=>{e.clients.forEach(t=>{t.sort((a,i)=>a.clock-i.clock);let r,n;for(r=1,n=1;r<t.length;r++){const a=t[n-1],i=t[r];a.clock+a.len===i.clock?a.len+=i.len:(n<r&&(t[n]=i),n++)}t.length=n})},dt=e=>{const t=new te;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,a)=>{if(!t.clients.has(a)){const i=n.slice();for(let o=r+1;o<e.length;o++)Kr(i,e[o].clients.get(a)||[]);t.clients.set(a,i)}});return lt(t),t},ke=(e,t,r,n)=>{j(e.clients,t,()=>[]).push(new ct(r,n))},Se=()=>new te,ht=e=>{const t=Se();return e.clients.forEach((r,n)=>{const a=[];for(let i=0;i<r.length;i++){const o=r[i];if(o.deleted){const s=o.id.clock;let c=o.length;if(i+1<r.length)for(let l=r[i+1];i+1<r.length&&l.id.clock===s+c&&l.deleted;l=r[++i+1])c+=l.length;a.push(new ct(s,c))}}a.length>0&&t.clients.set(n,a)}),t},X=(e,t)=>{y(e.restEncoder,t.clients.size),t.clients.forEach((r,n)=>{e.resetDsCurVal(),y(e.restEncoder,n);const a=r.length;y(e.restEncoder,a);for(let i=0;i<a;i++){const o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},pt=e=>{const t=new te,r=g(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();const a=g(e.restDecoder),i=g(e.restDecoder);if(i>0){const o=j(t.clients,a,()=>[]);for(let s=0;s<i;s++)o.push(new ct(e.readDsClock(),e.readDsLen()))}}return t},zt=(e,t,r)=>{const n=new te,a=g(e.restDecoder);for(let i=0;i<a;i++){e.resetDsCurVal();const o=g(e.restDecoder),s=g(e.restDecoder),c=r.clients.get(o)||[],l=A(r,o);for(let d=0;d<s;d++){const h=e.readDsClock(),p=h+e.readDsLen();if(h<l){l<p&&ke(n,o,l,p-l);let u=E(c,h),f=c[u];for(!f.deleted&&f.id.clock<h&&(c.splice(u+1,0,Ne(t,f,h-f.id.clock)),u++);u<c.length&&(f=c[u++],f.id.clock<p);)f.deleted||(p<f.id.clock+f.length&&c.splice(u,0,Ne(t,f,p-f.id.clock)),f.delete(t))}else ke(n,o,h,p-h)}}if(n.clients.size>0){const i=new Ie;X(i,n),r.pendingDeleteReaders.push(new Te(L(i.toUint8Array())))}},Pt=Xt;class z extends Xe{constructor({guid:e=Wt(),gc:t=!0,gcFilter:r=()=>!0,meta:n=null,autoLoad:a=!1}={}){super();this.gc=t,this.gcFilter=r,this.clientID=Pt(),this.guid=e,this.share=new Map,this.store=new sa,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=a,this.meta=n}load(){const e=this._item;e!==null&&!this.shouldLoad&&w(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(e=>e.guid))}transact(e,t=null){w(this,e,t)}get(e,t=I){const r=j(this.share,e,()=>{const a=new t;return a._integrate(this,null),a}),n=r.constructor;if(t!==I&&n!==t)if(n===I){const a=new t;a._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=a}),a._start=r._start;for(let i=a._start;i!==null;i=i.right)i.parent=a;return a._length=r._length,this.share.set(e,a),a._integrate(this,null),a}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,q)}getText(e=""){return this.get(e,oe)}getMap(e=""){return this.get(e,K)}getXmlFragment(e=""){return this.get(e,Q)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){Pr(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;e.deleted?t.doc=null:(t.doc=new z({guid:this.guid,...t.opts}),t.doc._item=e),w(e.parent.doc,r=>{e.deleted||r.subdocsAdded.add(t.doc),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),super.destroy()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}}class re{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return g(this.restDecoder)}readDsLen(){return g(this.restDecoder)}}class In extends re{readLeftID(){return m(g(this.restDecoder),g(this.restDecoder))}readRightID(){return m(g(this.restDecoder),g(this.restDecoder))}readClient(){return g(this.restDecoder)}readInfo(){return me(this.restDecoder)}readString(){return he(this.restDecoder)}readParentInfo(){return g(this.restDecoder)===1}readTypeRef(){return g(this.restDecoder)}readLen(){return g(this.restDecoder)}readAny(){return Ke(this.restDecoder)}readBuf(){return tn(D(this.restDecoder))}readJSON(){return JSON.parse(he(this.restDecoder))}readKey(){return he(this.restDecoder)}}class Te{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=g(this.restDecoder),this.dsCurrVal}readDsLen(){const e=g(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class qt extends Te{constructor(e){super(e);this.keys=[],me(e),this.keyClockDecoder=new Pe(D(e)),this.clientDecoder=new qe(D(e)),this.leftClockDecoder=new Pe(D(e)),this.rightClockDecoder=new Pe(D(e)),this.infoDecoder=new Ut(D(e),me),this.stringDecoder=new $r(D(e)),this.parentInfoDecoder=new Ut(D(e),me),this.typeRefDecoder=new qe(D(e)),this.lenDecoder=new qe(D(e))}readLeftID(){return new P(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new P(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ke(this.restDecoder)}readBuf(){return D(this.restDecoder)}readJSON(){return Ke(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class ve{constructor(){this.restEncoder=new jt}toUint8Array(){return J(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){y(this.restEncoder,e)}writeDsLen(e){y(this.restEncoder,e)}}class Dn extends ve{writeLeftID(e){y(this.restEncoder,e.client),y(this.restEncoder,e.clock)}writeRightID(e){y(this.restEncoder,e.client),y(this.restEncoder,e.clock)}writeClient(e){y(this.restEncoder,e)}writeInfo(e){H(this.restEncoder,e)}writeString(e){de(this.restEncoder,e)}writeParentInfo(e){y(this.restEncoder,e?1:0)}writeTypeRef(e){y(this.restEncoder,e)}writeLen(e){y(this.restEncoder,e)}writeAny(e){Ze(this.restEncoder,e)}writeBuf(e){C(this.restEncoder,e)}writeJSON(e){de(this.restEncoder,JSON.stringify(e))}writeKey(e){de(this.restEncoder,e)}}class Ie{constructor(){this.restEncoder=new jt,this.dsCurrVal=0}toUint8Array(){return J(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,y(this.restEncoder,t)}writeDsLen(e){e===0&&M(),y(this.restEncoder,e-1),this.dsCurrVal+=e}}class ut extends Ie{constructor(){super();this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new $e,this.clientEncoder=new Qe,this.leftClockEncoder=new $e,this.rightClockEncoder=new $e,this.infoEncoder=new Lt(H),this.stringEncoder=new Qr,this.parentInfoEncoder=new Lt(H),this.typeRefEncoder=new Qe,this.lenEncoder=new Qe}toUint8Array(){const e=rn();return H(e,0),C(e,this.keyClockEncoder.toUint8Array()),C(e,this.clientEncoder.toUint8Array()),C(e,this.leftClockEncoder.toUint8Array()),C(e,this.rightClockEncoder.toUint8Array()),C(e,J(this.infoEncoder)),C(e,this.stringEncoder.toUint8Array()),C(e,J(this.parentInfoEncoder)),C(e,this.typeRefEncoder.toUint8Array()),C(e,this.lenEncoder.toUint8Array()),Zr(e,J(this.restEncoder)),J(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Ze(this.restEncoder,e)}writeBuf(e){C(this.restEncoder,e)}writeJSON(e){Ze(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(this.keyClock++)}}let Kt=ve,Cn=re,$t=Dn,Qt=In;const En=(e,t,r,n)=>{const a=E(t,n);y(e.restEncoder,t.length-a),e.writeClient(r),y(e.restEncoder,n);const i=t[a];i.write(e,n-i.id.clock);for(let o=a+1;o<t.length;o++)t[o].write(e,0)},Zt=(e,t,r)=>{const n=new Map;r.forEach((a,i)=>{A(t,i)>a&&n.set(i,a)}),ae(t).forEach((a,i)=>{r.has(i)||n.set(i,0)}),y(e.restEncoder,n.size),Array.from(n.entries()).sort((a,i)=>i[0]-a[0]).forEach(([a,i])=>{En(e,t.clients.get(a),a,i)})},xn=(e,t,r)=>{const n=g(e.restDecoder);for(let a=0;a<n;a++){const i=g(e.restDecoder),o=new Array(i),s=e.readClient();let c=g(e.restDecoder);t.set(s,o);for(let l=0;l<i;l++){const d=e.readInfo();if((Je&d)!==0){const h=(d&(ue|pe))===0,p=new b(m(s,c),null,(d&pe)===pe?e.readLeftID():null,null,(d&ue)===ue?e.readRightID():null,h?e.readParentInfo()?r.get(e.readString()):e.readLeftID():null,h&&(d&ze)===ze?e.readString():null,$a(e,d));o[l]=p,c+=p.length}else{const h=e.readLen();o[l]=new _(m(s,c),h),c+=h}}}return t},_n=(e,t)=>{const r=t.pendingStack,n=t.pendingClientsStructRefs,a=Array.from(n.keys()).sort((l,d)=>l-d);if(a.length===0)return;const i=()=>{let l=n.get(a[a.length-1]);for(;l.refs.length===l.i;)if(a.pop(),a.length>0)l=n.get(a[a.length-1]);else return t.pendingClientsStructRefs.clear(),null;return l};let o=i();if(o===null&&r.length===0)return;let s=r.length>0?r.pop():o.refs[o.i++];const c=new Map;for(;;){const l=j(c,s.id.client,()=>A(t,s.id.client)),d=s.id.clock<l?l-s.id.clock:0;if(s.id.clock+d!==l){const p=n.get(s.id.client)||{refs:[],i:0};if(p.refs.length!==p.i){const u=p.refs[p.i];if(u.id.clock<s.id.clock){p.refs[p.i]=s,s=u,p.refs=p.refs.slice(p.i).sort((f,G)=>f.id.clock-G.id.clock),p.i=0;continue}}r.push(s);return}const h=s.getMissing(e,t);if(h===null)if((d===0||d<s.length)&&(s.integrate(e,d),c.set(s.id.client,s.id.clock+s.length)),r.length>0)s=r.pop();else if(o!==null&&o.i<o.refs.length)s=o.refs[o.i++];else{if(o=i(),o===null)break;s=o.refs[o.i++]}else{const p=n.get(h)||{refs:[],i:0};if(p.refs.length===p.i){r.push(s);return}r.push(s),s=p.refs[p.i++]}}t.pendingClientsStructRefs.clear()},On=(e,t)=>{const r=t.pendingDeleteReaders;t.pendingDeleteReaders=[];for(let n=0;n<r.length;n++)zt(r[n],e,t)},Mn=(e,t)=>Zt(e,t.doc.store,t.beforeState),Yn=(e,t)=>{const r=e.pendingClientsStructRefs;t.forEach((n,a)=>{const i=r.get(a);if(i===void 0)r.set(a,{refs:n,i:0});else{const o=i.i>0?i.refs.slice(i.i):i.refs;for(let s=0;s<n.length;s++)o.push(n[s]);i.i=0,i.refs=o.sort((s,c)=>s.id.clock-c.id.clock)}})},Rn=e=>{e.forEach((t,r)=>{t.i===t.refs.length?e.delete(r):(t.refs.splice(0,t.i),t.i=0)})},Un=(e,t,r)=>{const n=new Map;xn(e,n,t.doc),Yn(r,n),_n(t,r),Rn(r.pendingClientsStructRefs),On(t,r)},mt=(e,t,r,n=new qt(e))=>w(t,a=>{Un(n,a,t.store),zt(n,a,t.store)},r,!1),jn=(e,t,r)=>mt(e,t,r,new Qt(e)),ft=(e,t,r,n=qt)=>{const a=L(t);mt(a,e,r,new n(a))},Ln=(e,t,r)=>ft(e,t,r,Qt),Nn=(e,t,r=new Map)=>{Zt(e,t.store,r),X(e,ht(t.store))},er=(e,t,r=new ut)=>{const n=t==null?new Map:tr(t);return Nn(r,e,n),r.toUint8Array()},Gn=(e,t)=>er(e,t,new $t),gt=e=>{const t=new Map,r=g(e.restDecoder);for(let n=0;n<r;n++){const a=g(e.restDecoder),i=g(e.restDecoder);t.set(a,i)}return t},Fn=e=>gt(new Te(L(e))),tr=e=>gt(new Cn(L(e))),rr=(e,t)=>(y(e.restEncoder,t.size),t.forEach((r,n)=>{y(e.restEncoder,n),y(e.restEncoder,r)}),e),Xn=(e,t)=>rr(e,ae(t.store)),nr=(e,t=new Ie)=>(Xn(t,e),t.toUint8Array()),Wn=e=>nr(e,new Kt);class Bn{constructor(){this.l=[]}}const ar=()=>new Bn,ir=(e,t)=>e.l.push(t),sr=(e,t)=>{const r=e.l,n=r.length;e.l=r.filter(a=>t!==a),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},or=(e,t,r)=>Nt(e.l,[t,r]);class P{constructor(e,t){this.client=e,this.clock=t}}const W=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,m=(e,t)=>new P(e,t),cr=(e,t)=>{y(e,t.client),y(e,t.clock)},lr=e=>m(g(e),g(e)),yt=e=>{for(const[t,r]of e.doc.share.entries())if(r===e)return t;throw M()},ne=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},Vn=e=>{const t=[];let r=e._start;for(;r;)t.push(r),r=r.right;console.log("Children: ",t),console.log("Children content: ",t.filter(n=>!n.deleted).map(n=>n.content))};class Hn{constructor(e,t=e.getMap("users")){const r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;const n=(a,i)=>{const o=a.get("ds"),s=a.get("ids"),c=l=>this.clients.set(l,i);o.observe(l=>{l.changes.added.forEach(d=>{d.content.getContent().forEach(h=>{h instanceof Uint8Array&&this.dss.set(i,dt([this.dss.get(i)||Se(),pt(new re(L(h)))]))})})}),this.dss.set(i,dt(o.map(l=>pt(new re(L(l)))))),s.observe(l=>l.changes.added.forEach(d=>d.content.getContent().forEach(c))),s.forEach(c)};t.observe(a=>{a.keysChanged.forEach(i=>n(t.get(i),i))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){const a=this.yusers;let i=a.get(r);i||(i=new K,i.set("ids",new q),i.set("ds",new q),a.set(r,i)),i.get("ids").push([t]),a.observe(o=>{setTimeout(()=>{const s=a.get(r);if(s!==i){i=s,this.clients.forEach((d,h)=>{r===d&&i.get("ids").push([h])});const c=new ve,l=this.dss.get(r);l&&(X(c,l),i.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",o=>{setTimeout(()=>{const s=i.get("ds"),c=o.deleteSet;if(o.local&&c.clients.size>0&&n(o,c)){const l=new ve;X(l,c),s.push([l.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(const[t,r]of this.dss.entries())if(Ae(r,e))return t;return null}}class De{constructor(e,t,r){this.type=e,this.tname=t,this.item=r}}const Jn=e=>new De(e.type==null?null:m(e.type.client,e.type.clock),e.tname||null,e.item==null?null:m(e.item.client,e.item.clock));class zn{constructor(e,t){this.type=e,this.index=t}}const Pn=(e,t)=>new zn(e,t),dr=(e,t)=>{let r=null,n=null;return e._item===null?n=yt(e):r=m(e._item.id.client,e._item.id.clock),new De(r,n,t)},qn=(e,t)=>{let r=e._start;for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return dr(e,m(r.id.client,r.id.clock+t));t-=r.length}r=r.right}return dr(e,null)},Kn=(e,t)=>{const{type:r,tname:n,item:a}=t;if(a!==null)y(e,0),cr(e,a);else if(n!==null)H(e,1),de(e,n);else if(r!==null)H(e,2),cr(e,r);else throw M();return e},$n=e=>{let t=null,r=null,n=null;switch(g(e)){case 0:n=lr(e);break;case 1:r=he(e);break;case 2:t=lr(e)}return new De(t,r,n)},Qn=(e,t)=>{const r=t.store,n=e.item,a=e.type,i=e.tname;let o=null,s=0;if(n!==null){if(A(r,n.client)<=n.clock)return null;const c=xt(r,n),l=c.item;if(!(l instanceof b))return null;if(o=l.parent,o._item===null||!o._item.deleted){s=l.deleted||!l.countable?0:c.diff;let d=l.left;for(;d!==null;)!d.deleted&&d.countable&&(s+=d.length),d=d.left}}else{if(i!==null)o=t.get(i);else if(a!==null){if(A(r,a.client)<=a.clock)return null;const{item:c}=xt(r,a);if(c instanceof b&&c.content instanceof Z)o=c.content.type;else return null}else throw M();s=o._length}return Pn(o,s)},Zn=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&W(e.item,t.item)&&W(e.type,t.type);class bt{constructor(e,t){this.ds=e,this.sv=t}}const ea=(e,t)=>{const r=e.ds.clients,n=t.ds.clients,a=e.sv,i=t.sv;if(a.size!==i.size||r.size!==n.size)return!1;for(const[o,s]of a.entries())if(i.get(o)!==s)return!1;for(const[o,s]of r.entries()){const c=n.get(o)||[];if(s.length!==c.length)return!1;for(let l=0;l<s.length;l++){const d=s[l],h=c[l];if(d.clock!==h.clock||d.len!==h.len)return!1}}return!0},hr=(e,t=new Ie)=>(X(t,e.ds),rr(t,e.sv),t.toUint8Array()),ta=e=>hr(e,new Kt),pr=(e,t=new Te(L(e)))=>new bt(pt(t),gt(t)),ra=e=>pr(e,new re(L(e))),wt=(e,t)=>new bt(e,t),na=wt(Se(),new Map),aa=e=>wt(ht(e.store),ae(e.store)),B=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Ae(t.ds,e.id),Ce=(e,t)=>{const r=j(e.meta,Ce,ee),n=e.doc.store;r.has(t)||(t.sv.forEach((a,i)=>{a<A(n,i)&&S(e,m(i,a))}),F(e,t.ds,a=>{}),r.add(t))},ia=(e,t,r=new z)=>{if(e.gc)throw new Error("originDoc must not be garbage collected");const{sv:n,ds:a}=t,i=new ut;return e.transact(o=>{let s=0;n.forEach(c=>{c>0&&s++}),y(i.restEncoder,s);for(const[c,l]of n){if(l===0)continue;l<A(e.store,c)&&S(o,m(c,l));const d=e.store.clients.get(c)||[],h=E(d,l-1);y(i.restEncoder,h+1),i.writeClient(c),y(i.restEncoder,0);for(let p=0;p<=h;p++)d[p].write(i,0)}X(i,a)}),ft(r,i.toUint8Array(),"snapshot"),r};class sa{constructor(){this.clients=new Map,this.pendingClientsStructRefs=new Map,this.pendingStack=[],this.pendingDeleteReaders=[]}}const ae=e=>{const t=new Map;return e.clients.forEach((r,n)=>{const a=r[r.length-1];t.set(n,a.id.clock+a.length)}),t},A=(e,t)=>{const r=e.clients.get(t);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},ur=(e,t)=>{let r=e.clients.get(t.id.client);if(r===void 0)r=[],e.clients.set(t.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==t.id.clock)throw M()}r.push(t)},E=(e,t)=>{let r=0,n=e.length-1,a=e[n],i=a.id.clock;if(i===t)return n;let o=We(t/(i+a.length-1)*n);for(;r<=n;){if(a=e[o],i=a.id.clock,i<=t){if(t<i+a.length)return o;r=o+1}else n=o-1;o=We((r+n)/2)}throw M()},oa=(e,t)=>{const r=e.clients.get(t.client);return r[E(r,t.clock)]},Ee=oa,At=(e,t,r)=>{const n=E(t,r),a=t[n];return a.id.clock<r&&a instanceof b?(t.splice(n+1,0,Ne(e,a,r-a.id.clock)),n+1):n},S=(e,t)=>{const r=e.doc.store.clients.get(t.client);return r[At(e,r,t.clock)]},mr=(e,t,r)=>{const n=t.clients.get(r.client),a=E(n,r.clock),i=n[a];return r.clock!==i.id.clock+i.length-1&&i.constructor!==_&&n.splice(a+1,0,Ne(e,i,r.clock-i.id.clock+1)),i},ca=(e,t,r)=>{const n=e.clients.get(t.id.client);n[E(n,t.id.clock)]=r},kt=(e,t,r,n,a)=>{if(n===0)return;const i=r+n;let o=At(e,t,r),s;do s=t[o++],i<s.id.clock+s.length&&At(e,t,i),a(s);while(o<t.length&&t[o].id.clock<i)};class fr{constructor(e,t,r){this.doc=e,this.deleteSet=new te,this.beforeState=ae(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const gr=(e,t)=>t.deleteSet.clients.size===0&&!nn(t.afterState,(r,n)=>t.beforeState.get(n)!==r)?!1:(lt(t.deleteSet),Mn(e,t),X(e,t.deleteSet),!0),la=(e,t,r)=>{const n=t._item;(n===null||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&j(e.changed,t,ee).add(r)},xe=(e,t)=>{const r=e[t-1],n=e[t];r.deleted===n.deleted&&r.constructor===n.constructor&&(r.mergeWith(n)&&(e.splice(t,1),n instanceof b&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r)))},yr=(e,t,r)=>{for(const[n,a]of e.clients.entries()){const i=t.clients.get(n);for(let o=a.length-1;o>=0;o--){const s=a[o],c=s.clock+s.len;for(let l=E(i,s.clock),d=i[l];l<i.length&&d.id.clock<c;d=i[++l]){const h=i[l];if(s.clock+s.len<=h.id.clock)break;h instanceof b&&h.deleted&&!h.keep&&r(h)&&h.gc(t,!1)}}}},br=(e,t)=>{e.clients.forEach((r,n)=>{const a=t.clients.get(n);for(let i=r.length-1;i>=0;i--){const o=r[i],s=en(a.length-1,1+E(a,o.clock+o.len-1));for(let c=s,l=a[c];c>0&&l.id.clock>=o.clock;l=a[--c])xe(a,c)}})},da=(e,t,r)=>{yr(e,t,r),br(e,t)},wr=(e,t)=>{if(t<e.length){const r=e[t],n=r.doc,a=n.store,i=r.deleteSet,o=r._mergeStructs;try{lt(i),r.afterState=ae(r.doc.store),n._transaction=null,n.emit("beforeObserverCalls",[r,n]);const s=[];r.changed.forEach((c,l)=>s.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(r,c)})),s.push(()=>{r.changedParentTypes.forEach((c,l)=>s.push(()=>{(l._item===null||!l._item.deleted)&&(c=c.filter(d=>d.target._item===null||!d.target._item.deleted),c.forEach(d=>{d.currentTarget=l}),c.sort((d,h)=>d.path.length-h.path.length),or(l._dEH,c,r))})),s.push(()=>n.emit("afterTransaction",[r,n]))}),Nt(s,[])}finally{n.gc&&yr(i,a,n.gcFilter),br(i,a),r.afterState.forEach((s,c)=>{const l=r.beforeState.get(c)||0;if(l!==s){const d=a.clients.get(c),h=Gt(E(d,l),1);for(let p=d.length-1;p>=h;p--)xe(d,p)}});for(let s=0;s<o.length;s++){const{client:c,clock:l}=o[s].id,d=a.clients.get(c),h=E(d,l);h+1<d.length&&xe(d,h+1),h>0&&xe(d,h)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(n.clientID=Pt(),Bt(be,ge,"[yjs] ",ye,at,"Changed the client-id because another client seems to be using it.")),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const s=new $t,c=gr(s,r);c&&n.emit("update",[s.toUint8Array(),r.origin,n])}if(n._observers.has("updateV2")){const s=new ut,c=gr(s,r);c&&n.emit("updateV2",[s.toUint8Array(),r.origin,n])}r.subdocsAdded.forEach(s=>n.subdocs.add(s)),r.subdocsRemoved.forEach(s=>n.subdocs.delete(s)),n.emit("subdocs",[{loaded:r.subdocsLoaded,added:r.subdocsAdded,removed:r.subdocsRemoved}]),r.subdocsRemoved.forEach(s=>s.destroy()),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):wr(e,t+1)}}},w=(e,t,r=null,n=!0)=>{const a=e._transactionCleanups;let i=!1;e._transaction===null&&(i=!0,e._transaction=new fr(e,r,n),a.push(e._transaction),a.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{i&&a[0]===e._transaction&&wr(a,0)}};class ha{constructor(e,t,r){this.ds=e,this.beforeState=t,this.afterState=r,this.meta=new Map}}const Ar=(e,t,r)=>{let n=null;const a=e.doc,i=e.scope;return w(a,o=>{for(;t.length>0&&n===null;){const s=a.store,c=t.pop(),l=new Set,d=[];let h=!1;c.afterState.forEach((p,u)=>{const f=c.beforeState.get(u)||0,G=p-f,Ge=s.clients.get(u);f!==p&&(S(o,m(u,f)),p<A(a.store,u)&&S(o,m(u,p)),kt(o,Ge,f,G,O=>{if(O instanceof b){if(O.redone!==null){let{item:x,diff:Ot}=xt(s,O.id);Ot>0&&(x=S(o,m(x.id.client,x.id.clock+Ot))),x.length>G&&S(o,m(x.id.client,p)),O=x}!O.deleted&&i.some(x=>ne(x,O))&&d.push(O)}}))}),F(o,c.ds,p=>{const u=p.id,f=u.clock,G=u.client,Ge=c.beforeState.get(G)||0,O=c.afterState.get(G)||0;p instanceof b&&i.some(x=>ne(x,p))&&!(f>=Ge&&f<O)&&l.add(p)}),l.forEach(p=>{h=Wr(o,p,l)!==null||h});for(let p=d.length-1;p>=0;p--){const u=d[p];e.deleteFilter(u)&&(u.delete(o),h=!0)}n=c,n!=null&&e.emit("stack-item-popped",[{stackItem:n,type:r},e])}o.changed.forEach((s,c)=>{s.has(null)&&c._searchMarker&&(c._searchMarker.length=0)})},e),n};class pa extends Xe{constructor(e,{captureTimeout:t=500,deleteFilter:r=()=>!0,trackedOrigins:n=new Set([null])}={}){super();this.scope=e instanceof Array?e:[e],this.deleteFilter=r,n.add(this),this.trackedOrigins=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=this.scope[0].doc,this.lastChange=0,this.doc.on("afterTransaction",a=>{if(!this.scope.some(h=>a.changedParentTypes.has(h))||!this.trackedOrigins.has(a.origin)&&(!a.origin||!this.trackedOrigins.has(a.origin.constructor)))return;const i=this.undoing,o=this.redoing,s=i?this.redoStack:this.undoStack;i?this.stopCapturing():o||(this.redoStack=[]);const c=a.beforeState,l=a.afterState,d=Fe();if(d-this.lastChange<t&&s.length>0&&!i&&!o){const h=s[s.length-1];h.ds=dt([h.ds,a.deleteSet]),h.afterState=l}else s.push(new ha(a.deleteSet,c,l));!i&&!o&&(this.lastChange=d),F(a,a.deleteSet,h=>{h instanceof b&&this.scope.some(p=>ne(p,h))&&_t(h,!0)}),this.emit("stack-item-added",[{stackItem:s[s.length-1],origin:a.origin,type:i?"redo":"undo"},this])})}clear(){this.doc.transact(e=>{const t=r=>{F(e,r.ds,n=>{n instanceof b&&this.scope.some(a=>ne(a,n))&&_t(n,!1)})};this.undoStack.forEach(t),this.redoStack.forEach(t)}),this.undoStack=[],this.redoStack=[]}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let e;try{e=Ar(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){this.redoing=!0;let e;try{e=Ar(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}}class ie{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null}get path(){return ua(this.currentTarget,this.target)}deletes(e){return Ae(this.transaction.deleteSet,e.id)}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){const t=this.target,r=ee(),n=ee(),a=[],i=new Map;e={added:r,deleted:n,delta:a,keys:i};const o=this.transaction.changed.get(t);if(o.has(null)){let s=null;const c=()=>{s&&a.push(s)};for(let l=t._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((s===null||s.delete===void 0)&&(c(),s={delete:0}),s.delete+=l.length,n.add(l)):this.adds(l)?((s===null||s.insert===void 0)&&(c(),s={insert:[]}),s.insert=s.insert.concat(l.content.getContent()),r.add(l)):((s===null||s.retain===void 0)&&(c(),s={retain:0}),s.retain+=l.length);s!==null&&s.retain===void 0&&c()}o.forEach(s=>{if(s!==null){const c=t._map.get(s);let l,d;if(this.adds(c)){let h=c.left;for(;h!==null&&this.adds(h);)h=h.left;if(this.deletes(c))if(h!==null&&this.deletes(h))l="delete",d=Be(h.content.getContent());else return;else h!==null&&this.deletes(h)?(l="update",d=Be(h.content.getContent())):(l="add",d=void 0)}else if(this.deletes(c))l="delete",d=Be(c.content.getContent());else return;i.set(s,{action:l,oldValue:d})}}),this._changes=e}return e}}const ua=(e,t)=>{const r=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)r.unshift(t._item.parentSub);else{let n=0,a=t._item.parent._start;for(;a!==t._item&&a!==null;)a.deleted||n++,a=a.right;r.unshift(n)}t=t._item.parent}return r},kr=80;let St=0;class ma{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=St++}}const fa=e=>{e.timestamp=St++},Sr=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=St++},ga=(e,t,r)=>{if(e.length>=kr){const n=e.reduce((a,i)=>a.timestamp<i.timestamp?a:i);return Sr(n,t,r),n}else{const n=new ma(t,r);return e.push(n),n}},_e=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const r=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>et(t-i.index)<et(t-o.index)?i:o);let n=e._start,a=0;for(r!==null&&(n=r.p,a=r.index,fa(r));n.right!==null&&a<t;){if(!n.deleted&&n.countable){if(t<a+n.length)break;a+=n.length}n=n.right}for(;n.left!==null&&a>t;)n=n.left,!n.deleted&&n.countable&&(a-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(a-=n.length);return r!==null&&et(r.index-a)<n.parent.length/kr?(Sr(r,n,a),r):ga(e._searchMarker,n,a)},se=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){const a=e[n];if(r>0){let i=a.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(a.index-=i.length);if(i===null||i.marker===!0){e.splice(n,1);continue}a.p=i,i.marker=!0}(t<a.index||r>0&&t===a.index)&&(a.index=Gt(t,a.index+r))}},ya=e=>{let t=e._start;const r=[];for(;t;)r.push(t),t=t.right;return r},Oe=(e,t,r)=>{const n=e,a=t.changedParentTypes;for(;!(j(a,e,()=>[]).push(r),e._item===null);)e=e._item.parent;or(n._eH,r,t)};class I{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ar(),this._dEH=ar(),this._searchMarker=null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Y()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){ir(this._eH,e)}observeDeep(e){ir(this._dEH,e)}unobserve(e){sr(this._eH,e)}unobserveDeep(e){sr(this._dEH,e)}toJSON(){}}const Tr=e=>{const t=[];let r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let a=0;a<n.length;a++)t.push(n[a])}r=r.right}return t},ba=(e,t)=>{const r=[];let n=e._start;for(;n!==null;){if(n.countable&&B(n,t)){const a=n.content.getContent();for(let i=0;i<a.length;i++)r.push(a[i])}n=n.right}return r},Me=(e,t)=>{let r=0,n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const a=n.content.getContent();for(let i=0;i<a.length;i++)t(a[i],r++,e)}n=n.right}},vr=(e,t)=>{const r=[];return Me(e,(n,a)=>{r.push(t(n,a,e))}),r},wa=e=>{let t=e._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};r=t.content.getContent(),n=0,t=t.right}const a=r[n++];return r.length<=n&&(r=null),{done:!1,value:a}}}},Aa=(e,t)=>{const r=_e(e,t);let n=e._start;for(r!==null&&(n=r.p,t-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Ir=(e,t,r,n)=>{let a=r;const i=e.doc,o=i.clientID,s=i.store,c=r===null?t._start:r.right;let l=[];const d=()=>{l.length>0&&(a=new b(m(o,A(s,o)),a,a&&a.lastId,c,c&&c.id,t,null,new V(l)),a.integrate(e,0),l=[])};n.forEach(h=>{switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:d();switch(h.constructor){case Uint8Array:case ArrayBuffer:a=new b(m(o,A(s,o)),a,a&&a.lastId,c,c&&c.id,t,null,new ce(new Uint8Array(h))),a.integrate(e,0);break;case z:a=new b(m(o,A(s,o)),a,a&&a.lastId,c,c&&c.id,t,null,new je(h)),a.integrate(e,0);break;default:if(h instanceof I)a=new b(m(o,A(s,o)),a,a&&a.lastId,c,c&&c.id,t,null,new Z(h)),a.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},Dr=(e,t,r,n)=>{if(r===0)return t._searchMarker&&se(t._searchMarker,r,n.length),Ir(e,t,null,n);const a=r,i=_e(t,r);let o=t._start;for(i!==null&&(o=i.p,r-=i.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&S(e,m(o.id.client,o.id.clock+r));break}r-=o.length}return t._searchMarker&&se(t._searchMarker,a,n.length),Ir(e,t,o,n)},Cr=(e,t,r,n)=>{if(n===0)return;const a=r,i=n,o=_e(t,r);let s=t._start;for(o!==null&&(s=o.p,r-=o.index);s!==null&&r>0;s=s.right)!s.deleted&&s.countable&&(r<s.length&&S(e,m(s.id.client,s.id.clock+r)),r-=s.length);for(;n>0&&s!==null;)s.deleted||(n<s.length&&S(e,m(s.id.client,s.id.clock+n)),s.delete(e),n-=s.length),s=s.right;if(n>0)throw Br("array length exceeded");t._searchMarker&&se(t._searchMarker,a,-i+n)},Er=(e,t,r)=>{const n=t._map.get(r);n!==void 0&&n.delete(e)},xr=(e,t,r,n)=>{const a=t._map.get(r)||null,i=e.doc,o=i.clientID;let s;if(n==null)s=new V([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:s=new V([n]);break;case Uint8Array:s=new ce(n);break;case z:s=new je(n);break;default:if(n instanceof I)s=new Z(n);else throw new Error("Unexpected content type")}new b(m(o,A(i.store,o)),a,a&&a.lastId,null,null,t,r,s).integrate(e,0)},_r=(e,t)=>{const r=e._map.get(t);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},ka=e=>{const t={};return e._map.forEach((r,n)=>{r.deleted||(t[n]=r.content.getContent()[r.length-1])}),t},Sa=(e,t)=>{const r=e._map.get(t);return r!==void 0&&!r.deleted},Ta=(e,t,r)=>{let n=e._map.get(t)||null;for(;n!==null&&(!r.sv.has(n.id.client)||n.id.clock>=(r.sv.get(n.id.client)||0));)n=n.left;return n!==null&&B(n,r)?n.content.getContent()[n.length-1]:void 0},Ye=e=>Sn(e.entries(),t=>!t[1].deleted);class Or extends ie{constructor(e,t){super(e,t);this._transaction=t}}class q extends I{constructor(){super();this._prelimContent=[],this._searchMarker=[]}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new q}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Oe(this,e,new Or(this,e))}insert(e,t){this.doc!==null?w(this.doc,r=>{Dr(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?w(this.doc,r=>{Cr(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Aa(this,e)}toArray(){return Tr(this)}toJSON(){return this.map(e=>e instanceof I?e.toJSON():e)}map(e){return vr(this,e)}forEach(e){Me(this,e)}[Symbol.iterator](){return wa(this)}_write(e){e.writeTypeRef(Ba)}}const va=e=>new q;class Mr extends ie{constructor(e,t,r){super(e,t);this.keysChanged=r}}class K extends I{constructor(e){super();this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new K}_callObserver(e,t){Oe(this,e,new Mr(this,e,t))}toJSON(){const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const n=t.content.getContent()[t.length-1];e[r]=n instanceof I?n.toJSON():n}}),e}get size(){return[...Ye(this._map)].length}keys(){return ot(Ye(this._map),e=>e[0])}values(){return ot(Ye(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ot(Ye(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){const t={};return this._map.forEach((r,n)=>{r.deleted||e(r.content.getContent()[r.length-1],n,this)}),t}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?w(this.doc,t=>{Er(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?w(this.doc,r=>{xr(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return _r(this,e)}has(e){return Sa(this,e)}_write(e){e.writeTypeRef(Va)}}const Ia=e=>new K,N=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&qr(e,t);class Tt{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){this.right===null&&M();switch(this.right.content.constructor){case v:case T:this.right.deleted||(this.index+=this.right.length);break;case k:this.right.deleted||$(this.currentAttributes,this.right.content);break}this.left=this.right,this.right=this.right.right}}const Yr=(e,t,r)=>{for(;t.right!==null&&r>0;){switch(t.right.content.constructor){case v:case T:t.right.deleted||(r<t.right.length&&S(e,m(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length);break;case k:t.right.deleted||$(t.currentAttributes,t.right.content);break}t.left=t.right,t.right=t.right.right}return t},Re=(e,t,r)=>{const n=new Map,a=_e(t,r);if(a){const i=new Tt(a.p.left,a.p,a.index,n);return Yr(e,i,r-a.index)}else{const i=new Tt(null,t._start,0,n);return Yr(e,i,r)}},Rr=(e,t,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===k&&N(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const a=e.doc,i=a.clientID;let o=r.left;const s=r.right;n.forEach((c,l)=>{o=new b(m(i,A(a.store,i)),o,o&&o.lastId,s,s&&s.id,t,null,new k(l,c)),o.integrate(e,0)})},$=(e,t)=>{const{key:r,value:n}=t;n===null?e.delete(r):e.set(r,n)},Ur=(e,t)=>{for(;!(e.right===null);){if(!(e.right.deleted||e.right.content.constructor===k&&N(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},jr=(e,t,r,n)=>{const a=e.doc,i=a.clientID,o=new Map;for(const s in n){const c=n[s],l=r.currentAttributes.get(s)||null;if(!N(l,c)){o.set(s,l);const{left:d,right:h}=r;r.right=new b(m(i,A(a.store,i)),d,d&&d.lastId,h,h&&h.id,t,null,new k(s,c)),r.right.integrate(e,0),r.forward()}}return o},vt=(e,t,r,n,a)=>{r.currentAttributes.forEach((p,u)=>{a[u]===void 0&&(a[u]=null)});const i=e.doc,o=i.clientID;Ur(r,a);const s=jr(e,t,r,a),c=n.constructor===String?new T(n):new v(n);let{left:l,right:d,index:h}=r;t._searchMarker&&se(t._searchMarker,r.index,c.getLength()),d=new b(m(o,A(i.store,o)),l,l&&l.lastId,d,d&&d.id,t,null,c),d.integrate(e,0),r.right=d,r.index=h,r.forward(),Rr(e,t,r,s)},Lr=(e,t,r,n,a)=>{const i=e.doc,o=i.clientID;Ur(r,a);const s=jr(e,t,r,a);for(;n>0&&r.right!==null;){if(!r.right.deleted)switch(r.right.content.constructor){case k:{const{key:c,value:l}=r.right.content,d=a[c];d!==void 0&&(N(d,l)?s.delete(c):s.set(c,l),r.right.delete(e));break}case v:case T:n<r.right.length&&S(e,m(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new b(m(o,A(i.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new T(c)),r.right.integrate(e,0),r.forward()}Rr(e,t,r,s)},Nr=(e,t,r,n,a)=>{for(;r&&r.content.constructor!==T&&r.content.constructor!==v;)!r.deleted&&r.content.constructor===k&&$(a,r.content),r=r.right;let i=0;for(;t!==r;){if(!t.deleted){const o=t.content;switch(o.constructor){case k:{const{key:s,value:c}=o;((a.get(s)||null)!==c||(n.get(s)||null)===c)&&(t.delete(e),i++);break}}}t=t.right}return i},Da=(e,t)=>{for(;t&&t.right&&(t.right.deleted||t.right.content.constructor!==T&&t.right.content.constructor!==v);)t=t.right;const r=new Set;for(;t&&(t.deleted||t.content.constructor!==T&&t.content.constructor!==v);){if(!t.deleted&&t.content.constructor===k){const n=t.content.key;r.has(n)?t.delete(e):r.add(n)}t=t.left}},Ca=e=>{let t=0;return w(e.doc,r=>{let n=e._start,a=e._start,i=Mt();const o=fe(i);for(;a;){if(a.deleted===!1)switch(a.content.constructor){case k:$(o,a.content);break;case v:case T:t+=Nr(r,n,a,i,o),i=fe(o),n=a;break}a=a.right}}),t},Gr=(e,t,r)=>{const n=r,a=fe(t.currentAttributes),i=t.right;for(;r>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case v:case T:r<t.right.length&&S(e,m(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e);break}t.forward()}i&&Nr(e,i,t.right,a,fe(t.currentAttributes));const o=(t.left||t.right).parent;return o._searchMarker&&se(o._searchMarker,t.index,-n+r),t};class Fr extends ie{constructor(e,t){super(e,t);this._delta=null}get delta(){if(this._delta===null){const e=this.target.doc;this._delta=[],w(e,t=>{const r=this._delta,n=new Map,a=new Map;let i=this.target._start,o=null;const s={};let c="",l=0,d=0;const h=()=>{if(o!==null){let p;switch(o){case"delete":p={delete:d},d=0;break;case"insert":p={insert:c},n.size>0&&(p.attributes={},n.forEach((u,f)=>{u!==null&&(p.attributes[f]=u)})),c="";break;case"retain":if(p={retain:l},Object.keys(s).length>0){p.attributes={};for(const u in s)p.attributes[u]=s[u]}l=0;break}r.push(p),o=null}};for(;i!==null;){switch(i.content.constructor){case v:this.adds(i)?this.deletes(i)||(h(),o="insert",c=i.content.embed,h()):this.deletes(i)?(o!=="delete"&&(h(),o="delete"),d+=1):i.deleted||(o!=="retain"&&(h(),o="retain"),l+=1);break;case T:this.adds(i)?this.deletes(i)||(o!=="insert"&&(h(),o="insert"),c+=i.content.str):this.deletes(i)?(o!=="delete"&&(h(),o="delete"),d+=i.length):i.deleted||(o!=="retain"&&(h(),o="retain"),l+=i.length);break;case k:{const{key:p,value:u}=i.content;if(this.adds(i)){if(!this.deletes(i)){const f=n.get(p)||null;N(f,u)?i.delete(t):(o==="retain"&&h(),N(u,a.get(p)||null)?delete s[p]:s[p]=u)}}else if(this.deletes(i)){a.set(p,u);const f=n.get(p)||null;N(f,u)||(o==="retain"&&h(),s[p]=f)}else if(!i.deleted){a.set(p,u);const f=s[p];f!==void 0&&(N(f,u)?i.delete(t):(o==="retain"&&h(),u===null?s[p]=u:delete s[p]))}i.deleted||(o==="insert"&&h(),$(n,i.content));break}}i=i.right}for(h();r.length>0;){const p=r[r.length-1];if(p.retain!==void 0&&p.attributes===void 0)r.pop();else break}})}return this._delta}}class oe extends I{constructor(e){super();this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new oe}_callObserver(e,t){super._callObserver(e,t);const r=new Fr(this,e),n=e.doc;if(!e.local){let a=!1;for(const[i,o]of e.afterState.entries()){const s=e.beforeState.get(i)||0;if(o===s)continue;if(kt(e,n.store.clients.get(i),s,o,c=>{!c.deleted&&c.content.constructor===k&&(a=!0)}),a)break}a||F(e,e.deleteSet,i=>{if(i instanceof _||a)return;i.parent===this&&i.content.constructor===k&&(a=!0)}),w(n,i=>{a?Ca(this):F(i,i.deleteSet,o=>{if(o instanceof _)return;o.parent===this&&Da(i,o)})})}Oe(this,e,r)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===T&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?w(this.doc,r=>{const n=new Tt(null,this._start,0,new Map);for(let a=0;a<e.length;a++){const i=e[a];if(i.insert!==void 0){const o=!t&&typeof i.insert=="string"&&a===e.length-1&&n.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof o!="string"||o.length>0)&&vt(r,this,n,o,i.attributes||{})}else i.retain!==void 0?Lr(r,this,n,i.retain,i.attributes||{}):i.delete!==void 0&&Gr(r,n,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){const n=[],a=new Map,i=this.doc;let o="",s=this._start;function c(){if(o.length>0){const l={};let d=!1;a.forEach((p,u)=>{d=!0,l[u]=p});const h={insert:o};d&&(h.attributes=l),n.push(h),o=""}}return w(i,l=>{for(e&&Ce(l,e),t&&Ce(l,t);s!==null;){if(B(s,e)||t!==void 0&&B(s,t))switch(s.content.constructor){case T:{const d=a.get("ychange");e!==void 0&&!B(s,e)?(d===void 0||d.user!==s.id.client||d.state!=="removed")&&(c(),a.set("ychange",r?r("removed",s.id):{type:"removed"})):t!==void 0&&!B(s,t)?(d===void 0||d.user!==s.id.client||d.state!=="added")&&(c(),a.set("ychange",r?r("added",s.id):{type:"added"})):d!==void 0&&(c(),a.delete("ychange")),o+=s.content.str;break}case v:{c();const d={insert:s.content.embed};if(a.size>0){const h={};d.attributes=h,a.forEach((p,u)=>{h[u]=p})}n.push(d);break}case k:B(s,e)&&(c(),$(a,s.content));break}s=s.right}c()},Ce),n}insert(e,t,r){if(t.length<=0)return;const n=this.doc;n!==null?w(n,a=>{const i=Re(a,this,e);r||(r={},i.currentAttributes.forEach((o,s)=>{r[s]=o})),vt(a,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r={}){if(t.constructor!==Object)throw new Error("Embed must be an Object");const n=this.doc;n!==null?w(n,a=>{const i=Re(a,this,e);vt(a,this,i,t,r)}):this._pending.push(()=>this.insertEmbed(e,t,r))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?w(r,n=>{Gr(n,Re(n,this,e),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const n=this.doc;n!==null?w(n,a=>{const i=Re(a,this,e);if(i.right===null)return;Lr(a,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}_write(e){e.writeTypeRef(Ha)}}const Ea=e=>new oe;class It{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Ue||t.constructor===Q)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Q extends I{constructor(){super();this._prelimContent=[]}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Q}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new It(this,e)}querySelector(e){e=e.toUpperCase();const t=new It(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e),r=t.next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Array.from(new It(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Oe(this,e,new Xr(this,t,e))}toString(){return vr(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),Me(this,a=>{n.insertBefore(a.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?w(this.doc,r=>{Dr(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}delete(e,t=1){this.doc!==null?w(this.doc,r=>{Cr(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Tr(this)}_write(e){e.writeTypeRef(za)}}const xa=e=>new Q;class Ue extends Q{constructor(e="UNDEFINED"){super();this.nodeName=e,this._prelimAttrs=new Map}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new Ue(this.nodeName)}toString(){const e=this.getAttributes(),t=[],r=[];for(const o in e)r.push(o);r.sort();const n=r.length;for(let o=0;o<n;o++){const s=r[o];t.push(s+'="'+e[s]+'"')}const a=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${a}${i}>${super.toString()}</${a}>`}removeAttribute(e){this.doc!==null?w(this.doc,t=>{Er(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?w(this.doc,r=>{xr(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return _r(this,e)}getAttributes(e){return ka(this)}toDOM(e=document,t={},r){const n=e.createElement(this.nodeName),a=this.getAttributes();for(const i in a)n.setAttribute(i,a[i]);return Me(this,i=>{n.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(Ja),e.writeKey(this.nodeName)}}const _a=e=>new Ue(e.readKey());class Xr extends ie{constructor(e,t,r){super(e,r);this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}}class Dt extends K{constructor(e){super();this.hookName=e}_copy(){return new Dt(this.hookName)}toDOM(e=document,t={},r){const n=t[this.hookName];let a;return n!==void 0?a=n.createDom(this):a=document.createElement(this.hookName),a.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(a,this),a}_write(e){e.writeTypeRef(Pa),e.writeKey(this.hookName)}}const Oa=e=>new Dt(e.readKey());class Ct extends oe{_copy(){return new Ct}toDOM(e=document,t,r){const n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{const t=[];for(const n in e.attributes){const a=[];for(const i in e.attributes[n])a.push({key:i,value:e.attributes[n][i]});a.sort((i,o)=>i.key<o.key?-1:1),t.push({nodeName:n,attrs:a})}t.sort((n,a)=>n.nodeName<a.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){const a=t[n];r+=`<${a.nodeName}`;for(let i=0;i<a.attrs.length;i++){const o=a.attrs[i];r+=` ${o.key}="${o.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(qa)}}const Ma=e=>new Ct;class Et{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Y()}mergeWith(e){return!1}write(e,t,r){throw Y()}integrate(e,t){throw Y()}}const Ya=0;class _ extends Et{get deleted(){return!0}delete(){}mergeWith(e){return this.length+=e.length,!0}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),ur(e.doc.store,this)}write(e,t){e.writeInfo(Ya),e.writeLen(this.length-t)}getMissing(e,t){return null}}class ce{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ce(this.content)}splice(e){throw Y()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const Ra=e=>new ce(e.readBuf());class le{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new le(this.len)}splice(e){const t=new le(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){ke(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const Ua=e=>new le(e.readLen());class je{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new je(this.doc)}splice(e){throw Y()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const ja=e=>new je(new z({guid:e.readString(),...e.readAny()}));class v{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new v(this.embed)}splice(e){throw Y()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const La=e=>new v(e.readJSON());class k{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new k(this.key,this.value)}splice(e){throw Y()}mergeWith(e){return!1}integrate(e,t){t.parent._searchMarker=null}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Na=e=>new k(e.readString(),e.readJSON());class Le{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Le(this.arr)}splice(e){const t=new Le(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){const a=this.arr[n];e.writeString(a===void 0?"undefined":JSON.stringify(a))}}getRef(){return 2}}const Ga=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++){const a=e.readString();a==="undefined"?r.push(void 0):r.push(JSON.parse(a))}return new Le(r)};class V{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new V(this.arr)}splice(e){const t=new V(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){const a=this.arr[n];e.writeAny(a)}}getRef(){return 8}}const Fa=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new V(r)};class T{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new T(this.str)}splice(e){const t=new T(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const Xa=e=>new T(e.readString()),Wa=[va,Ia,Ea,_a,xa,Oa,Ma],Ba=0,Va=1,Ha=2,Ja=3,za=4,Pa=5,qa=6;class Z{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Z(this.type._copy())}splice(e){throw Y()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const Ka=e=>new Z(Wa[e.readTypeRef()](e)),xt=(e,t)=>{let r=t,n=0,a;do n>0&&(r=m(r.client,r.clock+n)),a=Ee(e,r),n=r.clock-a.id.clock,r=a.redone;while(r!==null&&a instanceof b);return{item:a,diff:n}},_t=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},Ne=(e,t,r)=>{const{client:n,clock:a}=t.id,i=new b(m(n,a+r),t,m(n,a+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=m(t.redone.client,t.redone.clock+r)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=r,i},Wr=(e,t,r)=>{const n=e.doc,a=n.store,i=n.clientID,o=t.redone;if(o!==null)return S(e,o);let s=t.parent._item,c,l;if(t.parentSub===null)c=t.left,l=t;else{for(c=t;c.right!==null;)if(c=c.right,c.id.client!==i)return null;c.right!==null&&(c=t.parent._map.get(t.parentSub)),l=null}if(s!==null&&s.deleted===!0&&s.redone===null&&(!r.has(s)||Wr(e,s,r)===null))return null;if(s!==null&&s.redone!==null){for(;s.redone!==null;)s=S(e,s.redone);for(;c!==null;){let u=c;for(;u!==null&&u.parent._item!==s;)u=u.redone===null?null:S(e,u.redone);if(u!==null&&u.parent._item===s){c=u;break}c=c.left}for(;l!==null;){let u=l;for(;u!==null&&u.parent._item!==s;)u=u.redone===null?null:S(e,u.redone);if(u!==null&&u.parent._item===s){l=u;break}l=l.right}}const d=A(a,i),h=m(i,d),p=new b(h,c,c&&c.lastId,l,l&&l.id,s===null?t.parent:s.content.type,t.parentSub,t.content.copy());return t.redone=h,_t(p,!0),p.integrate(e,0),p};class b extends Et{constructor(e,t,r,n,a,i,o,s){super(e,s.getLength());this.origin=r,this.left=t,this.right=n,this.rightOrigin=a,this.parent=i,this.parentSub=o,this.redone=null,this.content=s,this.info=this.content.isCountable()?Yt:0}set marker(e){(this.info&Ve)>0!==e&&(this.info^=Ve)}get marker(){return(this.info&Ve)>0}get keep(){return(this.info&Rt)>0}set keep(e){this.keep!==e&&(this.info^=Rt)}get countable(){return(this.info&Yt)>0}get deleted(){return(this.info&He)>0}set deleted(e){this.deleted!==e&&(this.info^=He)}markDeleted(){this.info|=He}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=A(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=A(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===P&&this.id.client!==this.parent.client&&this.parent.clock>=A(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=mr(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=S(e,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===_||this.right&&this.right.constructor===_)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===b&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===b&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===P){const r=Ee(t,this.parent);r.constructor===_?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=mr(e,e.doc.store,m(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;const a=new Set,i=new Set;for(;n!==null&&n!==this.right;){if(i.add(n),a.add(n),W(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,a.clear();else if(W(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&i.has(Ee(e.doc.store,n.origin)))a.has(Ee(e.doc.store,n.origin))||(r=n,a.clear());else break;n=n.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ur(e.doc.store,this),this.content.integrate(e,this),la(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new _(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:m(this.id.client,this.id.clock+this.length-1)}mergeWith(e){return W(e.origin,this.lastId)&&this.right===e&&W(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)?(e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0):!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),ke(e.deleteSet,this.id.client,this.id.clock,this.length),j(e.changed,t,ee).add(this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw M();this.content.gc(e),t?ca(e,this,new _(this.id,this.length)):this.content=new le(this.length)}write(e,t){const r=t>0?m(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,a=this.parentSub,i=this.content.getRef()&Je|(r===null?0:pe)|(n===null?0:ue)|(a===null?0:ze);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){const o=this.parent,s=o._item;if(s===null){const c=yt(o);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(s.id);a!==null&&e.writeString(a)}this.content.write(e,t)}}const $a=(e,t)=>Qa[t&Je](e),Qa=[()=>{throw M()},Ua,Ga,Ra,Xa,La,Na,Ka,Fa,ja];export{ra as $,Tn as A,ge as B,V as C,z as D,ie as E,Mr as F,rt as G,Fr as H,P as I,Xr as J,ft as K,W as L,Zn as M,Qn as N,Se as O,Hn as P,ht as Q,De as R,bt as S,fr as T,ye as U,ia as V,m as W,Jn as X,q as Y,qn as Z,wt as _,Gn as a,pr as a0,tr as a1,Fn as a2,na as a3,ta as a4,hr as a5,er as a6,nr as a7,ea as a8,yt as a9,A as aa,ya as ab,Ae as ac,ne as ad,F as ae,Vn as af,$n as ag,jn as ah,mt as ai,aa as aj,w as ak,da as al,ba as am,Ta as an,Kn as ao,Ln as b,kn as c,we as d,Wn as e,Et as f,I as g,ce as h,le as i,v as j,k,Le as l,T as m,Z as n,_ as o,b as p,K as q,hn as r,oe as s,pa as t,Wt as u,Ue as v,Q as w,Dt as x,Ct as y,Or as z};
